---
import contactBg from "../assets/img/aboutDIVCAL3.png";
---

<section
  id="contacto"
  class="relative py-16 bg-gray-900 text-white font-system overflow-hidden"
>
  <div class="absolute inset-0 z-0">
    <img
      src={contactBg.src}
      alt="Fondo de contacto"
      class="w-full h-full object-cover object-right"
    />
  </div>

  <div class="absolute inset-0 bg-black/65 z-10 pointer-events-none"></div>

  <div class="relative z-20 max-w-7xl mx-auto px-6">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-16 items-center">
      <div>
        <h2 class="text-5xl font-bold mb-2 text-white">Contacto</h2>
        <p class="text-lg mb-8 text-gray-300">
          ¿Listo para conectar con el talento ideal? Escríbenos.
        </p>

        <ul class="space-y-3 text-lg">
          <li class="text-white"><strong>Ubicación:</strong> Lima, Perú</li>
          <li class="text-white">
            <strong>Email:</strong> contacto@divcalpe.com
          </li>
          <li class="text-white"><strong>WhatsApp:</strong> +51 997959646</li>
        </ul>
      </div>

      <div
        class="bg-gray-800 p-10 rounded-xl shadow-2xl w-full max-w-lg md:ml-auto"
      >
        <form id="contactForm">
          <h3
            class="text-sm font-black uppercase mb-6 text-white tracking-wider"
          >
            PARA CONTRATAR NUESTROS SERVICIOS DÉJANOS TUS DATOS
          </h3>

          <div class="flex gap-4 mb-4">
            <div class="flex-1 flex flex-col">
              <label for="nombre" class="mb-1 text-xs font-semibold text-white"
                >Nombre <span class="text-red-500">*</span></label
              >
              <input
                type="text"
                id="nombre"
                name="nombre"
                class="w-full px-3 py-2 border-none rounded text-sm bg-white text-gray-900"
                required
                maxlength="50"
              />
            </div>
            <div class="flex-1 flex flex-col">
              <label
                for="apellidos"
                class="mb-1 text-xs font-semibold text-white"
                >Apellidos <span class="text-red-500">*</span></label
              >
              <input
                type="text"
                id="apellidos"
                name="apellidos"
                class="w-full px-3 py-2 border-none rounded text-sm bg-white text-gray-900"
                required
                maxlength="50"
              />
            </div>
          </div>

          <div class="flex gap-4 mb-4">
            <div class="flex-1 flex flex-col">
              <label for="email" class="mb-1 text-xs font-semibold text-white"
                >Correo electrónico <span class="text-red-500">*</span></label
              >
              <input
                type="email"
                id="email"
                name="email"
                class="w-full px-3 py-2 border-none rounded text-sm bg-white text-gray-900"
                required
                pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                maxlength="254"
                minlength="5"
              />
            </div>
            <div class="flex-1 flex flex-col">
              <label
                for="telefono"
                class="mb-1 text-xs font-semibold text-white"
                >Número de teléfono <span class="text-red-500">*</span></label
              >
              <input
                type="tel"
                id="telefono"
                name="telefono"
                class="w-full px-3 py-2 border-none rounded text-sm bg-white text-gray-900"
                required
                inputmode="numeric"
                minlength="7"
                maxlength="15"
              />
            </div>
          </div>

          <div class="flex gap-4 mb-4">
            <div class="flex-1 flex flex-col">
              <label for="empresa" class="mb-1 text-xs font-semibold text-white"
                >Empresa <span class="text-red-500">*</span></label
              >
              <input
                type="text"
                id="empresa"
                name="empresa"
                class="w-full px-3 py-2 border-none rounded text-sm bg-white text-gray-900"
                required
                maxlength="100"
              />
            </div>
            <div class="flex-1 flex flex-col">
              <label for="cargo" class="mb-1 text-xs font-semibold text-white"
                >Cargo <span class="text-red-500">*</span></label
              >
              <input
                type="text"
                id="cargo"
                name="cargo"
                class="w-full px-3 py-2 border-none rounded text-sm bg-white text-gray-900"
                required
                maxlength="100"
              />
            </div>
          </div>

          <div class="flex flex-col mb-4">
            <label for="mensaje" class="mb-1 text-xs font-semibold text-white"
              >Mensaje <span class="text-red-500">*</span></label
            >
            <textarea
              id="mensaje"
              name="mensaje"
              rows="4"
              class="w-full px-3 py-2 border-none rounded text-sm bg-white text-gray-900 resize-none"
              required></textarea>
          </div>

          <div class="mb-6">
            <label
              class="flex items-center gap-2 text-xs text-gray-300 cursor-pointer"
            >
              <input
                type="checkbox"
                name="privacy"
                class="w-auto m-0"
                required
              />
              <span
                >He leído y acepto la <a
                  href="#"
                  target="_blank"
                  class="text-white underline"
                  >Política de privacidad de DIVCALPE</a
                ></span
              >
            </label>
          </div>

          <button
            class="w-full px-4 py-3 bg-cyan-400 text-black font-bold rounded-full transition-all duration-200 hover:bg-cyan-500 hover:-translate-y-0.5 disabled:bg-gray-400 disabled:cursor-not-allowed"
            type="submit"
          >
            Entremos en contacto
          </button>

          <p id="contactMsg" class="mt-4 text-center font-bold text-sm"></p>
        </form>
      </div>
    </div>
  </div>
</section>
<script>
  const telefono = document.getElementById("telefono");
  telefono!.addEventListener("keypress", (e) => {
    if (!/[0-9]/.test(e.key)) {
      e.preventDefault();
    }
  });
</script>

<script>
  const form = document.getElementById("contactForm") as HTMLFormElement | null;
  const msg = document.getElementById("contactMsg") as HTMLElement | null;
  if (form && msg) {
    const btn = form.querySelector(
      'button[type="submit"]'
    ) as HTMLButtonElement | null;
    const privacy = form.querySelector(
      'input[name="privacy"]'
    ) as HTMLInputElement | null;
    const setMsg = (text: string, color: string = "red") => {
      msg.textContent = text;
      msg.style.color = color;
    };
    const setLoading = (loading: boolean) => {
      if (!btn) return;
      btn.disabled = loading;
      btn.innerText = loading ? "Enviando..." : "Entremos en contacto";
    };
    form.addEventListener("submit", async (e: SubmitEvent) => {
      e.preventDefault();
      setMsg("");
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }
      if (!privacy || !privacy.checked) {
        setMsg("Debes aceptar la política de privacidad", "red");
        privacy?.focus();
        return;
      }
      setLoading(true);
      try {
        const data = new FormData(form);
        const payload = {
          nombre: data.get("nombre"),
          apellidos: data.get("apellidos"),
          empresa: data.get("empresa"),
          cargo: data.get("cargo"),
          email: data.get("email"),
          telefono: data.get("telefono"),
          mensaje: data.get("mensaje"),
          privacy: data.get("privacy") ? true : false,
        };
        const res = await fetch("https://divcalpe.com/contact.php", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(payload),
        });
        const result = await res.json().catch(() => ({}) as any);
        if (res.ok && result.success) {
          setMsg("Mensaje enviado correctamente", "#4dd0e1");
          form.reset();
        } else {
          setMsg(result.error || "Hubo un error al enviar el mensaje.", "red");
        }
      } catch {
        setMsg("Hubo un error al enviar el mensaje.", "red");
      } finally {
        setLoading(false);
      }
    });
  }
</script>
